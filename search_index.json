[["index.html", "Bayesian latent growth models with Stan Introduction", " Bayesian latent growth models with Stan David Selby Centre for Epidemiology Versus Arthritis University of Manchester Last compiled 26 February 2021 Introduction This is a living document, recording my current state of knowledge about growth mixture models (and related classes of models) and how to fit them using R and Stan. The motivation for this report is being able to fit growth curve models and latent class growth curve models using R (R Core Team 2021) and Stan (Guo et al. 2020). There are various packages available for fitting growth models, but not necessarily for doing so in the flexible Bayesian way. Canonically, the main package to use in R for this purpose is lcmm (Proust-Lima, Philipps, and Liquet 2017) and the corresponding plugin in Stata is traj (Jones and Nagin 2013). References "],["background.html", "Part 1 Background 1.1 Latent processes 1.2 Semantic growth", " Part 1 Background 1.1 Latent processes There are a many names for classes of models that describing repeated measures with (possibly heterogeneous) random effects. A latent process mixed model, as presented in the R package lcmm (Proust-Lima, Philipps, and Liquet 2017), is a term used to describe a generalized linear mixed model of the form \\[\\begin{equation} Y_{ij} = H\\left( \\Lambda(t_{ij}) + \\varepsilon_{ij}~;~ \\eta \\right), \\tag{1.1} \\end{equation}\\] where \\(Y_{ij}\\) is the response for subject \\(i\\) at occasion \\(j\\), at time point \\(t_{ij}\\) with independent normally-distributed measurement error \\(\\varepsilon_{ij}\\). The function \\(H(\\cdot)\\) represents a link function (parametrised by \\(\\eta\\)) relating the response to the linear mixed model latent process given by \\[\\begin{equation} \\Lambda(t) = X(t) \\beta + Z(t) u_i, \\tag{1.2} \\end{equation}\\] for covariate vectors \\(Z(t) \\subset X(t)\\), fixed effects \\(\\beta\\) and random effects \\(u_i\\). The link function \\(H\\) may be linear, and in the case of an identity link, the latent process reduces to a linear mixed model. Else it may represent a distribution function or quadratic L-spline basis. Psychology texts might refer to the same idea by the name latent curve analysis. Within the structural equation modelling framework, Equation (1.2) describes the structural model, while Equation (1.1) is called the measurement model. A mixture of such models is named a latent class mixed model, growth mixture model, group-based trajectory model, heterogeneous mixed model or mixed mixture model, depending on the correlation structure of the random effects. The class or cluster of subject \\(i\\) is denoted by a latent discrete random variable \\(c_i\\) and follows a multinomial logistic model (possibly with covariates predicting class membership). Then for each subject \\(i\\), the model (1.1) is conditional on the class, with fixed effects of covariates may be either common over the classes or class-specific, and random effects that are class specific. See the lcmm::hlme() vignette for examples. The package lcmm supports (via the hlme and lcmm functions) random effects that have either common or heterogeneous (but similarly structured) covariances (toggled via the nwg argument). Meanwhile R package flexmix allows for varying correlation structure between the latent classes; the differences between the two packages are outlined in detail by Wardenaar (2020 and compared with the proprietary statistical software Mplus). These tools are frequentist, based on maximum likelihood esimation; later we will evaluate Bayesian alternatives that work via Markov chain Monte Carlo (MCMC) sampling. 1.2 Semantic growth Some authors draw distinctions between growth curve modelling, growth mixture modelling and group-based trajectory modelling (Nagin and Odgers 2010; Nagin 2014) but the differences between these approaches are largely semantic or contextual and essentially the three methods describe the same thing. At worst, the techniques are special cases of one another: e.g. growth curve modelling being a degenerate growth mixture model with one mixture component. The word ‘curve’ or ‘trajectory’ is redundant and ‘group’ is synonymous with a mixture component; these semantic variations undoubtedly confuse more than they help clarify. Growth models are generalized linear models with optional random effects (Rosen 1991). As an example of a multilevel mixed linear model (Steele 2007), growth curves can be fitted using standard software, such as the R package lme4 (Bates et al. 2020). There is nothing particularly essential about repeated measures being longitudinal, either: the variable representing time (or age) may be exchanged for any other continuous predictor. Here we describe only a family of related methods, aiming to distinguish by explicit technical differences rather than arbitrary naming conventions. Every such model can be explained in terms of a hierarchical Bayesian model, aided by the expressive power of the Stan language (Guo et al. 2020). To be continued… References "],["mixed-effects-models.html", "Part 2 Mixed effects models 2.1 Restricted maximum likelihood 2.2 Markov chain Monte Carlo", " Part 2 Mixed effects models A mixed model, also known as a hierarchical or multilevel model, in general contains both random (subject or group level) and fixed (population level) effects. 2.1 Restricted maximum likelihood The standard way for fitting mixed effects models in R is lme4 (Bates et al. 2020), which estimates the parameters via restricted maximum likelihood optimization. A canonical example dataset is sleepstudy, bundled with the package, which records reaction times each day for 18 subjects restricted to three hours of sleep per night. The data are visualised in Figure 2.1. Figure 2.1: Average reaction time per day (ms) for 18 subjects in a sleep deprivation study. Each line represents one subject Overall, we would probably expect reaction times to increase as the subjects become more sleep-deprived. But some subjects surely will have had faster reaction times than others, even before the study began. This is modelled using a random intercept coefficient. Meanwhile, we might assume each day of sleep deprivation results in the same increase in reaction time for every participant, in which case a common, fixed slope coefficient is appropriate. However, if instead we thought the daily effect of sleep deprivation varied between subjects, we could fit random slopes (as well as the random intercept). In lme4 syntax, the random intercept model is library(lme4) rand_intercept &lt;- lmer(Reaction ~ Days + (1 | Subject), sleepstudy) which yields the following summary output. Linear mixed model fit by REML [&#39;lmerMod&#39;] Formula: Reaction ~ Days + (1 | Subject) Data: sleepstudy REML criterion at convergence: 1786.5 Scaled residuals: Min 1Q Median 3Q Max -3.2257 -0.5529 0.0109 0.5188 4.2506 Random effects: Groups Name Variance Std.Dev. Subject (Intercept) 1378.2 37.12 Residual 960.5 30.99 Number of obs: 180, groups: Subject, 18 Fixed effects: Estimate Std. Error t value (Intercept) 251.4051 9.7467 25.79 Days 10.4673 0.8042 13.02 Correlation of Fixed Effects: (Intr) Days -0.371 Adding a random slope, we obtain rand_slope &lt;- lmer(Reaction ~ Days + (Days | Subject), sleepstudy) Linear mixed model fit by REML [&#39;lmerMod&#39;] Formula: Reaction ~ Days + (Days | Subject) Data: sleepstudy REML criterion at convergence: 1743.6 Scaled residuals: Min 1Q Median 3Q Max -3.9536 -0.4634 0.0231 0.4634 5.1793 Random effects: Groups Name Variance Std.Dev. Corr Subject (Intercept) 612.10 24.741 Days 35.07 5.922 0.07 Residual 654.94 25.592 Number of obs: 180, groups: Subject, 18 Fixed effects: Estimate Std. Error t value (Intercept) 251.405 6.825 36.838 Days 10.467 1.546 6.771 Correlation of Fixed Effects: (Intr) Days -0.138 The correlation between the random effects is close to zero. 2.2 Markov chain Monte Carlo Researchers who prefer a Bayesian approach can take advantage of the rstanarm (Gabry and Goodrich 2020) and brms (Bürkner 2020) packages, which allow specifying analogous Bayesian models, fitted using Hamiltonian Monte Carlo (rather than restricted maximum likelihood) but using the familiar lme4-style formula syntax. If using default priors, the code is nearly identical. The package rstanarm (applied regression modelling via RStan) has a series of functions with the prefix stan_ that are analogous to common frequentist methods, e.g. stan_glm and, in this case, stan_lmer: library(rstanarm) arm_slope &lt;- stan_lmer(Reaction ~ Days + (Days | Subject), sleepstudy) stan_lmer family: gaussian [identity] formula: Reaction ~ Days + (Days | Subject) observations: 180 ------ Median MAD_SD (Intercept) 251.3 6.6 Days 10.4 1.7 Auxiliary parameter(s): Median MAD_SD sigma 25.9 1.6 Error terms: Groups Name Std.Dev. Corr Subject (Intercept) 24.3 Days 6.9 0.08 Residual 26.0 Num. levels: Subject 18 ------ * For help interpreting the printed output see ?print.stanreg * For info on the priors used see ?prior_summary.stanreg Meanwhile, brms (Bayesian regression modelling with Stan), which is designed for fitting Bayesian multilevel models, has a single workhorse function, brm, which also uses lme4-style formulae: library(brms) brm_slope &lt;- brm(Reaction ~ Days + (Days | Subject), sleepstudy) Family: gaussian Links: mu = identity; sigma = identity Formula: Reaction ~ Days + (Days | Subject) Data: sleepstudy (Number of observations: 180) Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1; total post-warmup samples = 4000 Group-Level Effects: ~Subject (Number of levels: 18) Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS sd(Intercept) 26.89 6.90 15.67 42.53 1.00 1637 1891 sd(Days) 6.56 1.51 4.13 9.95 1.00 1383 2191 cor(Intercept,Days) 0.09 0.31 -0.47 0.71 1.00 872 1352 Population-Level Effects: Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS Intercept 251.32 7.47 236.12 265.87 1.00 1578 1641 Days 10.38 1.68 7.00 13.70 1.00 1599 2094 Family Specific Parameters: Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS sigma 25.94 1.56 23.05 29.14 1.00 3318 2783 Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS and Tail_ESS are effective sample size measures, and Rhat is the potential scale reduction factor on split chains (at convergence, Rhat = 1). As with other Stan wrapper packages, if you don’t specify any prior distributions, then uninformative ones will be used by default. This is usually fine in this case but you’ll need to set explicit priors when fitting more complicated models. All three of lme4, rstanarm and brms yield similar parameter estimates for the sleep deprivation study model with random intercepts and slopes: fixed intercept about 251 ms fixed slope about 10.5 ms per day random intercept standard deviation about 24 ms random slope standard deviation about 6 ms per day random intercept–slope correlation about 0.07–0.08 References "],["bibliography.html", "Bibliography", " Bibliography .csl-entry { margin-top: .75em; } "]]
